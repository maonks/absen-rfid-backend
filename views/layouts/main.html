<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Absensi RFID</title>

  <!-- HTMX -->
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-100" hx-boost="false">

<!-- ================= MOBILE HEADER ================= -->
<header class="md:hidden fixed top-0 left-0 right-0 z-50
               h-14 bg-slate-900 text-white
               flex items-center px-4 shadow">

  <button
    onclick="toggleSidebar()"
    class="text-xl mr-3"
  >
    â˜°
  </button>

  <span class="font-semibold">Absensi RFID</span>
</header>

<!-- ================= LAYOUT WRAPPER ================= -->
<div class="flex min-h-screen pt-14 md:pt-0">

  <!-- ================= SIDEBAR ================= -->
  <aside
    id="sidebar"
    class="fixed md:static inset-y-0 left-0 z-40
           w-56 bg-slate-900 text-white
           transform -translate-x-full md:translate-x-0
           transition-transform duration-300
           flex flex-col"
  >

    <!-- HEADER -->
    <div class="p-4 text-lg font-bold text-center border-b border-slate-700">
      ğŸ‘¤âŒ Absensi Online
    </div>

    <!-- MENU -->
    <nav class="flex-1 mt-4 space-y-1">


      <a href="/" class="flex items-center gap-3 px-4 py-3 hover:bg-slate-700 transition">
        <span class="text-lg">ğŸ </span>
        <span>Home Dashboard</span>
      </a>

      <a href="/monitor" class="flex items-center gap-3 px-4 py-3 hover:bg-slate-700 transition">
        <span class="text-lg">ğŸ“¡</span>
        <span>Monitoring Log</span>
      </a>

      <a href="/absensi" class="flex items-center gap-3 px-4 py-3 hover:bg-slate-700 transition">
        <span class="text-lg">ğŸ“Š</span>
        <span>Detail Absensi</span>
      </a>

      <a href="/siswa" class="flex items-center gap-3 px-4 py-3 hover:bg-slate-700 transition">
        <span class="text-lg">ğŸ‘¨â€ğŸ“</span>
        <span>Data Siswa</span>
      </a>
         <a href="/kartu" class="flex items-center gap-3 px-4 py-3 hover:bg-slate-700 transition">
        <span class="text-lg">ğŸ’³</span>
        <span>Daftar Kartu</span>
      </a>
    </nav>

    <!-- FOOTER -->
    <div class="p-3 text-xs text-center text-slate-400 border-t border-slate-700">
      Â© 2026 MaonksCode
    </div>

  </aside>

  <!-- ================= OVERLAY MOBILE ================= -->
  <div
    id="overlay"
    onclick="toggleSidebar()"
    class="fixed inset-0 bg-black/40 z-30 hidden md:hidden"
  ></div>

  <!-- ================= MAIN CONTENT ================= -->
  <main class="flex-1 p-4 md:p-6">

    <!-- HEADER CONTENT -->
    <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-4 gap-2">

      <div>
        <h1 class="text-xl md:text-2xl font-bold">
          ğŸ“¡ Dashboard Absensi RFID
        </h1>
        <p class="text-sm text-gray-500">
          Â© 2026 maonks
        </p>
      </div>

      <div
        id="device-status"
        hx-get="/api/device-status"
        hx-trigger="load"
        class="flex gap-2"
      >
        â³ Memuat status device...
      </div>

    </div>

    <!-- CONTENT -->
    <div class="bg-white rounded-xl shadow p-4 md:p-6 space-y-4">
      {{ embed }}
    </div>

  </main>

</div>

<!-- MODAL -->
<div id="modal"></div>

<!-- ================= SCRIPT ================= -->
<script>
  function toggleSidebar() {
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");

    sidebar.classList.toggle("-translate-x-full");
    overlay.classList.toggle("hidden");
  }
</script>

<script>
  const ws = new WebSocket("ws://192.168.1.100:8000/websocket");

  ws.onmessage = (e) => {
    const absenTable = document.getElementById("absen-table");
    if (absenTable) {
      htmx.trigger(absenTable, "reload");
    }

    let data;
    try {
      data = JSON.parse(e.data); // { uid: "XXXX" }
    } catch {
      return; // jika bukan JSON, abaikan
    }

    if (!data.uid) return;

    // coba cari row siswa
    const row = document.getElementById("row-" + data.uid);

    if (row) {
      // siswa sudah ada â†’ refresh BARIS SAJA
      htmx.trigger(row, "refresh");
    } else {
      // siswa baru â†’ reload wrapper (tambah baris)
      const home = document.getElementById("home-realtime");
      if (home) {
        htmx.trigger(home, "reload");
      }
    }
  };
</script>


<script>
  function closeModal() {
    const modal = document.getElementById("modal");
    if (modal) modal.innerHTML = "";
  }
</script>

</body>
</html>
